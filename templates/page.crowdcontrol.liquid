{% capture widgets_soarr %}{{ settings.crwdctrl_widget_instagram_so }}_instagram,{{ settings.crwdctrl_widget_facebook_so }}_facebook,{{ settings.crwdctrl_widget_youtube_so }}_youtube,{{ settings.crwdctrl_widget_twitter_so }}_twitter,{{ settings.crwdctrl_widget_pinterest_so }}_pinterest{% endcapture %}

{% assign widgets_so_arr = widgets_soarr | split: ',' | sort %}

{% if settings.crwdctrl_widget_enable_instagram %}
{% capture instagram_body %}
		  <div class="instagram">
		  {{settings.crwdctrl_widget_instagram_embedcode}}
		    
		  </div>
{% endcapture %}
{% capture instagram_icon %}
	<svg xmlns="http://www.w3.org/2000/svg" class="sicon ins">
		<path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
	</svg>
{% endcapture %}
{% endif %}
{% if settings.crwdctrl_widget_enable_facebook %}
{% capture facebook_body %}
		  <div class="facebbok">
		    <div class="fb-page" data-href="{{settings.crwdctrl_widget_facebook_url}}" data-tabs="timeline,events,messages" data-width="500" data-height="700" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"></div>
			<div id="fb-root"></div>
			<script defer>(function(d, s, id) {
				  var js, fjs = d.getElementsByTagName(s)[0];
				  if (d.getElementById(id)) return;
				  js = d.createElement(s); js.id = id;
				  js.src = 'https://connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v3.1';
				  fjs.parentNode.insertBefore(js, fjs);
				}(document, 'script', 'facebook-jssdk'));
			</script>
		  </div>
{% endcapture %}
{% capture facebook_icon %}
	<svg xmlns="http://www.w3.org/2000/svg" class="sicon fb">
		<path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"/>
	</svg>
{% endcapture %}
{% endif %}
{% if settings.crwdctrl_widget_enable_youtube %}
{% capture youtube_body %}
		  <div class="youtube">
		    
		  </div>
{% endcapture %}
{% capture youtube_icon %}
	<svg xmlns="http://www.w3.org/2000/svg" class="sicon yt">
		<path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
	</svg>
{% endcapture %}
{% endif %}
{% if settings.crwdctrl_widget_enable_twitter %}
{% capture twitter_body %}
		  <div class="twitter">
		    <a class="twitter-follow-button"
			  href="https://twitter.com/{{settings.crwdctrl_widget_twitter_scrname}}"
			  data-show-screen-name="true"
			  data-show-count="true"
			  data-size="large">Follow @{{settings.crwdctrl_widget_twitter_scrname}}</a><br />
		    <a class="twitter-timeline" data-width="500" data-height="700" data-show-replies="false" data-theme="light" data-chrome="nofooter" href="https://twitter.com/{{settings.crwdctrl_widget_twitter_scrname}}?ref_src=twsrc%5Etfw">Tweets by {{settings.crwdctrl_widget_twitter_scrname}}</a>			
			<script defer>window.twttr = (function(d, s, id) {
				var js, fjs = d.getElementsByTagName(s)[0],
				t = window.twttr || {};
				if (d.getElementById(id)) return t;
				js = d.createElement(s);
				js.id = id;
				js.src = "https://platform.twitter.com/widgets.js";
				fjs.parentNode.insertBefore(js, fjs);
				t._e = [];
				t.ready = function(f) {
				t._e.push(f);
				};
				return t;
				}(document, "script", "twitter-wjs"));
			</script>
		  </div>
{% endcapture %}
{% capture twitter_icon %}
	<svg xmlns="http://www.w3.org/2000/svg" class="sicon tw">
		<path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
	</svg>
{% endcapture %}
{% endif %}
{% if settings.crwdctrl_widget_enable_pinterest %}
{% capture pinterest_body %}
		  <div class="pinterest">
		    <a data-pin-do="embedUser" data-pin-board-width="400" data-pin-scale-height="240" data-pin-scale-width="80" href="{{settings.crwdctrl_widget_pinterest_url}}"></a>
			<script async defer src="//assets.pinterest.com/js/pinit.js"></script>
		  </div>
{% endcapture %}
{% capture pinterest_icon %}
	<svg xmlns="http://www.w3.org/2000/svg" class="sicon pin">
		<path d="M12.14.5C5.86.5 2.7 5 2.7 8.75c0 2.27.86 4.3 2.7 5.05.3.12.57 0 .66-.33l.27-1.06c.1-.32.06-.44-.2-.73-.52-.62-.86-1.44-.86-2.6 0-3.33 2.5-6.32 6.5-6.32 3.55 0 5.5 2.17 5.5 5.07 0 3.8-1.7 7.02-4.2 7.02-1.37 0-2.4-1.14-2.07-2.54.4-1.68 1.16-3.48 1.16-4.7 0-1.07-.58-1.98-1.78-1.98-1.4 0-2.55 1.47-2.55 3.42 0 1.25.43 2.1.43 2.1l-1.7 7.2c-.5 2.13-.08 4.75-.04 5 .02.17.22.2.3.1.14-.18 1.82-2.26 2.4-4.33.16-.58.93-3.63.93-3.63.45.88 1.8 1.65 3.22 1.65 4.25 0 7.13-3.87 7.13-9.05C20.5 4.15 17.18.5 12.14.5z"/>
	</svg>
{% endcapture %}
{% endif %}

<div class="crwdctrl-widget-template">
<div id="crowdcontrol_social" class="crwdctrl-widget social">
<div class="widget">
  <div class="heading">
    <h1 class="head-title">{{settings.crwdctrl_widget_social_title}}</h1>
	<hr class="border" />
	<span class="skip">skip</span>
  </div>
  <div class="widget_body">
    <div class="widget_social">
	  {% for widget_nmso in widgets_so_arr %}
	  {% assign namesoarr = widget_nmso | split:'_' %}
	  {% capture widgetenable %}crwdctrl_widget_enable_{{namesoarr[1]}}{% endcapture %}
	  {% capture widgetheading %}crwdctrl_widget_{{namesoarr[1]}}_title{% endcapture %}
	  {%if settings[widgetenable] %}
	  {% capture sicon %}{{namesoarr[1]}}_icon{% endcapture %}
	  <div class="widgetpanel">
	    <div class="panelhead">
		  {{ [sicon] }}
		  <div class="htext">{{ settings[widgetheading] }} <span class="plusminus">+</span></div>
		</div>
		<div class="panelbody">			
		  {% capture widget_body %}{{namesoarr[1]}}_body{% endcapture %}
		  {{ [widget_body] }}
		</div>
	  </div>
	  {% endif %}
	  {% endfor %}
	</div>
  </div>
</div>
</div>
{% if settings.crwdctrl_widget_survey_enable %}
<div id="crowdcontrol_survey" class="crwdctrl-widget survey">
<div class="widget">
  <div class="heading">
    <h1 class="head-title">{{settings.crwdctrl_widget_survey_title}}</h1>
	<hr class="border" />
	<span class="skip">skip</span>
  </div>
  <div class="widget_body">
    <div class="widget_survey">
	  {{settings.crwdctrl_widget_survey_embedcode}}	  		
	</div>
  </div>
</div>
</div>
{% endif %}
{% if settings.crwdctrl_widget_referral_enable %}
<div id="crowdcontrol_referral" class="crwdctrl-widget referral">
<div class="widget">
  <div class="heading">
    <h1 class="head-title">{{settings.crwdctrl_widget_referral_title}}</h1>
	<hr class="border" />
	<span class="skip">skip</span>
  </div>
  <div class="widget_body">
    <div class="widget_referral">
	  {{ settings.crwdctrl_widget_referral_embedcode}}	  
	</div>
  </div>
</div>
</div>
{% endif %}
{% if settings.crwdctrl_widget_newsletter_enable %}
<div id="crowdcontrol_newsletter" class="crwdctrl-widget newsletter">
<div class="widget">
  <div class="heading">
    <h1 class="head-title">Would you like to receive updates regarding other crowdfunding campaigns?</h1>
	<hr class="border" />
	<span class="skip">skip</span>
  </div>
  <div class="widget_body">
    <div class="widget_newsletter">
	  <input type="email" name="email" />
	  <input type="button" name="btn_newsletter" value="Submit" />
	</div>
  </div>
</div>
</div>
{% endif %}
<div class="crwdctrl-widget btns">
<div class="widget">  
  <div class="widget_body">
    <div class="widget_btn">
	  {%if settings.crwdctrl_widget_btmbtn_text !=''%}
	  <input type="button" name="continue" value="{{settings.crwdctrl_widget_btmbtn_text}}" />
	  {% else %}
	  <input type="button" name="continue" value="Next" />
	  {% endif %}
	</div>
  </div>
</div>
</div>

</div>

{{ 'crowd-control-widget.scss.css' | asset_url | stylesheet_tag }}

<script type="text/javascript">
(function(){
  var loadScript = function(url, callback) {
	var script = document.createElement("script");
	script.type = "text/javascript";
	if (script.readyState){ 
	script.onreadystatechange = function(){
	  if (script.readyState == "loaded" || script.readyState == "complete"){
		script.onreadystatechange = null;
		if(typeof callback !== 'undefined') callback();
	  }
	};
	} else if(typeof callback !== 'undefined') {
	script.onload = function(){
	  callback();
	};
	}
	script.src = url;
	document.getElementsByTagName("head")[0].appendChild(script);    
  };

var crowdControlJavaScript = function($) {
  function isEmail(email) {
	var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-]{2,})+\.)+([a-zA-Z0-9]{2,4})+$/;
	if(!regex.test(email)) {
	   return false;
	}else{
	   return true;
	}
  }
  $(document).ready(function() {
	//accordian widget
	var youtubeHtml = '';
	{% if settings.crwdctrl_widget_enable_youtube %}
	youtubeHtml += '<script defer>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) return;js = d.createElement(s); js.id = id;js.src = \'https://apis.google.com/js/platform.js\';fjs.parentNode.insertBefore(js, fjs);}(document, \'script\', \'youtube-pjs\'));<\/script><div class="g-ytsubscribe" data-channel="{{settings.crwdctrl_widget_youtube_channel}}" data-layout="full" data-count="default"></div>';
	{% endif %}
	$('.widgetpanel .panelbody').hide();	
	$(".widgetpanel .panelhead").click(function() {
		var $widgetPanel = $('.widgetpanel');
		if ($('.panelbody', $widgetPanel).is(':visible')) {
			$('.panelbody', $widgetPanel).slideUp(500);
			$('.plusminus', $widgetPanel).removeClass('minus').text('+');
		}
		var $panelBody = $(this).next('.panelbody');
		if ($panelBody.is(':visible')) {
			$panelBody.slideUp(500);
			$('.plusminus', $(this)).text('+').removeClass('minus').addClass('plus');
		} else {
			$panelBody.slideDown(500);
			$('.plusminus', $(this)).text('-').removeClass('plus').addClass('minus');
			if ($panelBody.children('.youtube').length > 0) {
				$panelBody.children('.youtube').append(youtubeHtml);
			}
		}
	});
	$('.widgetpanel .panelhead').first().trigger('click');
	$(".skip").click(function() {
		var $widget = $(this).parents('.crwdctrl-widget');
		if ($widget.length > 0) {
    	var htop = 0;
    	if($(window).width() > 767) htop = $('.site-header').outerHeight();
			var nextSec = $widget.next();
			if (nextSec.length > 0) {
			  $('html, body').animate({
				scrollTop: nextSec.offset().top-htop
			  });
			}
		}
	});
	$('.widget_newsletter input[name="btn_newsletter"]').click(function() {
		var $this = $(this);
		$('.form_error, .form_success').remove();
		var $email = $('.widget_newsletter input[name="email"]').val();
		if (!isEmail($email)) {
			$(this).after('<span class="form_error">Please enter a valid email.</span>');
		} else {
		  $.ajax({
			url: 'https://crowdcontrol.us16.list-manage.com/subscribe/post-json?u=51565e6328e21be1e1f8efea1&id=71082021e4&c=?',
			crossDomain: true,
			cache: false,
			dataType: 'jsonp',
			data: {EMAIL:$email},
			success: function(resp) {
			  var msg = '';
			  if (resp.result === 'success') {
				msg = 'We have sent you a confirmation email';
				$this.after('<span class="form_success">' + msg + '</span>');
			  } else {
				try {
					var parts = resp.msg.split(' - ', 2);
					if (parts[1] === undefined) {
						msg = resp.msg;
					} else {
						var i = parseInt(parts[0], 10);
						if (i.toString() === parts[0]) {
							msg = parts[1];
						} else {
							msg = resp.msg;
						}
					}
				}
				catch (e) {
					msg = resp.msg;
				}
				$this.after('<span class="form_error">' + msg + '</span>');
			  }			  
			},
			error: function(jqXHR, exception) {
			  var msg = '';
			  if (jqXHR.status === 0) {
				msg = 'Not connect.\n Verify Network.';
			  } else if (jqXHR.status == 404) {
				msg = 'Requested page not found. [404]';
			  } else if (jqXHR.status == 500) {
				msg = 'Internal Server Error [500].';
			  } else if (exception === 'parsererror') {
				msg = 'Requested JSON parse failed.';
			  } else if (exception === 'timeout') {
				msg = 'Time out error.';
			  } else if (exception === 'abort') {
				msg = 'Ajax request aborted.';
			  } else {
				msg = 'Uncaught Error.\n' + jqXHR.responseText;
			  }
			  $this.after('<span class="form_error">' + msg + '</span>');
			}
		  });
		}
	});
	{% if settings.crwdctrl_widget_redirect == 'cart' %}
	var nextUrl = '/cart';
	{% else %}var nextUrl = '/checkout';{% endif %}
	var ccdiscount = sessionStorage.getItem('crwdctrl_discount');
	{% if settings.crwdctrl_widget_redirect == 'checkout' %}if (ccdiscount) {
	  nextUrl += '?discount='+ccdiscount;
	}{% endif %}
	$('.btns input[name="continue"]').click(function() {		
		location.href = nextUrl;
	});
  });
};

if ((typeof jQuery === 'undefined') || (parseFloat(jQuery.fn.jquery) < 2.1)) {
  loadScript('//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js', function(){
    crowdControlJavaScript(jQuery);
  });
} else {
  crowdControlJavaScript(jQuery);
}
})();
</script>